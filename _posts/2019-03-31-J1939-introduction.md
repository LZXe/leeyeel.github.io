---
layout: post
title:  "J1939 快速入门" 
date:   2019-03-31 22:05:00
categories: 学习笔记
tags: 汽车电子 J1939 CAN 
excerpt: 本文特别适合于对CAN有了解，对J1939不了解但是想了解的小伙伴。
mathjax: true
---

SAE J1939协议是基于CAN2.0B协议之上的应用层协议，但是SAE J1939协议并不仅仅是个应用层协议，她对物理层，数据链路层，网络层，应用层，故障诊断，
网络层管理层等都做了详细的规定,只不过这其中很多规定都跟CAN2.0B一致。我们这里只介绍J1939的应用层，对软件开发来说已经足够。
对熟悉CAN2.0B协议的小伙伴来说，其实只要掌握下面几个关键点，J1939就瞬间不再神秘。

- J1939协议是基于CAN2.0B的应用层协议，所有J1939报文都是使用29位标志符。

CAN报文中我们有11位标志符的标准帧也有29位标志符的扩展帧，在J1939协议中，我们所有报文都是29位标志符, 数据域则跟CAN报文的数据没有区别。

- CAN报文是基于ID的，而J1939协议是基于PGN的。

这一点几乎就是J1939协议的全部内容。CAN2.0B使用29位的标志符来区分不同的报文，J1939对这29标志符进行了重新的分类和解释。打个不是很恰当的比方，
以前CAN2.0B协议根据人的体重来区分不同的人，只要一样重(ID)就认为是相同的人群，体重越瘦的就越是受CAN2.0B协议喜欢(优先级越高),现在J1939也是测量体重，
只不过是把人的脑袋，躯干，双手，双腿分别测量，然后对这几个重量进行某种运算(比如脑袋重量的平方，躯干重量与双手重量乘积，以及双腿重量这三个数字之和),
只要运算的结果(PGN)一致，就认为这些人是一个人群。

也就是说,J1939对CAN2.0B中的29位标志进行了重新解释,我们使用下面这张图来说明一下:   

![]({{site.url}}/assets/J1939/sae-j1939-pgn.jpg)

上图中29位CAN ID本来是我们标识不同CAN报文的唯一标志符，现在我们对这29位进行了重新划分，其中前3位表示优先级(Priority)，中间18位表示PGN(Parameter Group Number),
后面8位表示源地址（Source Address)。中间18位的PNG又进一步划分为保留位(R), 数据页位(DP), PDU格式(PF),以及PDU特定域(PS)。

下面分别对这几个划分做简单介绍:

(注意到，由于CAN2.0B的仲裁机制是ID越小优先级别越高，同时按照J1939协议的划分，前3位在29位的最高位，依然控制着整个29位数据的ID大小)

(明天继续...)
